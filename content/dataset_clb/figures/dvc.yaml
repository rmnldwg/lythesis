stages:
  plots:
    foreach:
    - clb_statistics
    - tstage_comp
    do:
      cmd: python ${item}.py
      deps:
      - ${item}.py
      - ../data/2021-clb-oropharynx-enhanced.csv
      outs:
      - ${item}.svg

  sens-spec:
    cmd: >
      python sens_spec_plot.py
    deps:
    - sens_spec_plot.py
    - ../data/2021-clb-oropharynx-enhanced.csv
    outs:
    - sens_spec_plot.svg
    - ../tables:
        cache: false

  convert:
    foreach: 
    - sens_spec_plot
    - clb_statistics
    - tstage_comp
    do:
      cmd: >
        inkscape
        --without-gui
        --file=${item}.svg
        --export-pdf=${item}.pdf
        --export-latex
      deps:
      - ${item}.svg
      outs:
      - ${item}.pdf:
          cache: false
      - ${item}.pdf_tex:
          cache: false

  crop-figure:
    desc:
      This command replaces the line in the auto-generated `clb_statistics.pdf_tex` with an
      almost identical line, plus some margin trimming/cropping that is necessary to
      make the figure look good on paper.
    vars:
    - left: 13mm
    - bottom: 20mm
    - right: 15mm
    - top: 30mm
    cmd: >
      sed clb_statistics.pdf_tex
      -e '56s/.*/    \\put(0,0){\\includegraphics[width=\\unitlength,page=1,trim=${left} ${bottom} ${right} ${top}]{clb_statistics.pdf}}%/'
      > clb_statistics_crop.pdf_tex
    deps:
    - clb_statistics.pdf_tex
    outs:
    - clb_statistics_crop.pdf_tex:
        cache: false
